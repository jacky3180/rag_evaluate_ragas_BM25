# Ragas 指标配置功能测试指南

## 🧪 测试步骤

### 1. 启动服务器

```bash
# 确保在项目根目录
cd d:\curcorCode\rag_evaluate3

# 启动服务器
python run_server.py
# 或
python app.py
```

### 2. 打开浏览器

访问: `http://localhost:8000`

### 3. 测试设置按钮

- [ ] 在 "Ragas评估" 标题旁看到齿轮图标 ⚙️
- [ ] 鼠标悬停时图标旋转90度
- [ ] 点击图标打开配置弹框

### 4. 测试配置弹框

**弹框显示检查**:
- [ ] 弹框标题显示 "Ragas评估指标配置"
- [ ] 显示提示信息
- [ ] 显示 8 个指标分成两组
- [ ] Context Recall 和 Context Precision 复选框被禁用（已勾选）
- [ ] 其他 6 个指标可以自由勾选/取消
- [ ] 底部显示 "已选择 X 个指标"

**交互测试**:
- [ ] 取消一个可选指标，数量减少
- [ ] 重新勾选，数量增加
- [ ] 点击"取消"按钮，弹框关闭
- [ ] 点击弹框外部，弹框关闭

### 5. 测试配置保存

**场景1: 选择部分指标**

1. 打开设置弹框
2. 只保留以下指标：
   - ✅ Context Recall (必选)
   - ✅ Context Precision (必选)
   - ✅ Faithfulness
   - ✅ Answer Relevancy
3. 点击"确认"
4. 检查：
   - [ ] 显示成功消息: "配置已保存！已选择 4 个指标"
   - [ ] 弹框自动关闭
   - [ ] 检查项目根目录生成 `ragas_metrics_config.json`

**验证配置文件**:

```bash
# 查看配置文件
cat ragas_metrics_config.json

# 应该看到类似内容：
{
  "enabled_metrics": [
    "context_recall",
    "context_precision",
    "faithfulness",
    "answer_relevancy"
  ],
  "version": "1.0"
}
```

### 6. 测试评估功能

**运行评估**:

1. 选择标准数据集
2. 点击 "开始评估"
3. 观察控制台输出：

```
📈 设置评估指标...
✅ 已加载Ragas配置: 4 个指标
✅ 已设置 4 个评估指标: context_recall, context_precision, faithfulness, answer_relevancy
```

4. 检查：
   - [ ] 只评估选中的 4 个指标
   - [ ] 其他指标不计算（显示 - 或 N/A）
   - [ ] 评估时间明显缩短

### 7. 测试配置加载

**刷新页面**:

1. 刷新浏览器页面（F5）
2. 打开设置弹框
3. 检查：
   - [ ] 之前保存的配置被正确加载
   - [ ] 只有之前选择的 4 个指标被勾选

**重启服务器**:

1. 停止服务器（Ctrl+C）
2. 重新启动: `python run_server.py`
3. 访问 `http://localhost:8000`
4. 打开设置弹框
5. 检查：
   - [ ] 配置仍然保持
   - [ ] 运行评估使用保存的配置

### 8. 测试恢复默认配置

**方法1: 通过界面**

1. 打开设置弹框
2. 勾选全部 8 个指标
3. 点击"确认"
4. 检查：
   - [ ] 配置文件包含全部 8 个指标
   - [ ] 评估时使用全部指标

**方法2: 删除配置文件**

```bash
# 删除配置文件
rm ragas_metrics_config.json
# 或 Windows:
del ragas_metrics_config.json
```

1. 刷新页面
2. 打开设置弹框
3. 检查：
   - [ ] 所有 8 个指标都被勾选（默认配置）
   - [ ] 运行评估使用全部指标

### 9. 测试错误处理

**场景1: 尝试取消必选指标**

测试已在代码中实现必选项禁用，应该：
- [ ] Context Recall 和 Context Precision 的复选框被禁用
- [ ] 无法取消勾选

**场景2: 服务器连接失败**

1. 停止服务器
2. 打开设置弹框，修改配置，点击"确认"
3. 检查：
   - [ ] 显示警告: "配置已保存到本地（服务器连接失败）"
   - [ ] 配置仍保存到浏览器 localStorage

### 10. 性能测试

**完整评估 (8个指标)**:

- 记录评估时间: _____ 分钟
- 预期: 5-6 分钟

**快速评估 (4个指标)**:

- 记录评估时间: _____ 分钟
- 预期: 2-3 分钟
- 时间节省: _____% ⬇️

## ✅ 测试清单总结

- [ ] ✅ 设置按钮正常显示和交互
- [ ] ✅ 配置弹框正常打开和关闭
- [ ] ✅ 指标复选框正常工作
- [ ] ✅ 必选指标无法取消
- [ ] ✅ 配置保存成功
- [ ] ✅ 配置文件生成正确
- [ ] ✅ 评估使用选中的指标
- [ ] ✅ 配置持久化有效（刷新页面）
- [ ] ✅ 配置持久化有效（重启服务器）
- [ ] ✅ 恢复默认配置正常
- [ ] ✅ 错误处理正常
- [ ] ✅ 性能优化明显

## 🐛 常见问题排查

### 问题1: 设置按钮不显示

**检查**:
- CSS 文件是否正确引入
- 浏览器控制台是否有 404 错误

**解决**:
```bash
# 检查文件是否存在
ls static/ragas_settings.css
```

### 问题2: 点击设置按钮无反应

**检查**:
- JavaScript 文件是否正确引入
- 浏览器控制台是否有 JavaScript 错误

**解决**:
```bash
# 检查文件是否存在
ls static/ragas_settings.js

# 查看浏览器控制台 (F12)
```

### 问题3: 配置保存失败

**检查**:
- API 端点是否正常
- 服务器是否运行

**测试**:
```bash
# 测试 GET API
curl http://localhost:8000/api/ragas/config

# 测试 POST API
curl -X POST http://localhost:8000/api/ragas/config \
  -H "Content-Type: application/json" \
  -d '{"enabled_metrics": ["context_recall", "context_precision"]}'
```

### 问题4: 评估时仍使用全部指标

**检查**:
- 服务器是否重启以加载新代码
- 配置文件是否正确生成

**解决**:
1. 重启服务器
2. 检查控制台输出中的指标列表

## 📝 测试报告模板

```
# Ragas 指标配置功能测试报告

## 测试环境
- 操作系统: Windows 10
- Python版本: 3.12
- 浏览器: Chrome 120
- 测试日期: 2025-10-28

## 测试结果

### 功能测试
- 设置按钮: ✅ 通过
- 配置弹框: ✅ 通过
- 配置保存: ✅ 通过
- 配置加载: ✅ 通过
- 评估功能: ✅ 通过

### 性能测试
- 完整评估(8指标): 5.2 分钟
- 快速评估(4指标): 2.8 分钟
- 时间节省: 46% ⬇️

### 问题记录
- 无

## 结论
✅ 所有测试通过，功能正常运行
```

---

**测试状态**: ⏳ 待测试  
**最后更新**: 2025-10-28

